


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > CSVService</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">ch.uzh.ifi.hase.soprafs23.questionGenerator.question</a>
</div>

<h1>Coverage Summary for Class: CSVService (ch.uzh.ifi.hase.soprafs23.questionGenerator.question)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CSVService</td>
<td class="coverageStat">
  <span class="percent">
    84.6%
  </span>
  <span class="absValue">
    (11/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    95.3%
  </span>
  <span class="absValue">
    (61/64)
  </span>
</td>
</tr>
  <tr>
    <td class="name">CSVService$$EnhancerBySpringCGLIB$$ff879ede</td>
  </tr>
  <tr>
    <td class="name">CSVService$$EnhancerBySpringCGLIB$$ff879ede$$FastClassBySpringCGLIB$$a7883dd9</td>
  </tr>
  <tr>
    <td class="name">CSVService$$FastClassBySpringCGLIB$$a0dbfcec</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    84.6%
  </span>
  <span class="absValue">
    (11/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    95.3%
  </span>
  <span class="absValue">
    (61/64)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package ch.uzh.ifi.hase.soprafs23.questionGenerator.question;
&nbsp;
&nbsp;import java.io.FileNotFoundException;
&nbsp;import java.io.FileReader;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collections;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import ch.uzh.ifi.hase.soprafs23.questionGenerator.QuestionPacker;
&nbsp;import ch.uzh.ifi.hase.soprafs23.questionGenerator.question.DTO.*;
&nbsp;import ch.uzh.ifi.hase.soprafs23.questionGenerator.question.entity.HanziDrawing;
&nbsp;import ch.uzh.ifi.hase.soprafs23.questionGenerator.question.entity.MultipleChoice;
&nbsp;import ch.uzh.ifi.hase.soprafs23.questionGenerator.question.entity.Question;
&nbsp;import ch.uzh.ifi.hase.soprafs23.questionGenerator.question.repository.ChoiceQuestionRepository;
&nbsp;import ch.uzh.ifi.hase.soprafs23.questionGenerator.question.repository.DrawingQuestionRepository;
&nbsp;import com.opencsv.bean.CsvToBeanBuilder;
&nbsp;import org.springframework.beans.factory.annotation.Autowired;
&nbsp;import org.springframework.beans.factory.annotation.Qualifier;
&nbsp;import org.springframework.data.jpa.repository.JpaRepository;
&nbsp;import org.springframework.stereotype.Service;
&nbsp;import org.springframework.transaction.annotation.Transactional;
&nbsp;
&nbsp;@Transactional
&nbsp;@Service
&nbsp;public class CSVService {
&nbsp;
&nbsp;    ChoiceQuestionRepository multipleChoiceRepository;
&nbsp;    DrawingQuestionRepository hanziDrawingRepository;
&nbsp;
&nbsp;    public ChoiceQuestionRepository getMultipleChoiceRepository() {
<b class="nc">&nbsp;        return multipleChoiceRepository;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setMultipleChoiceRepository(ChoiceQuestionRepository multipleChoiceRepository) {
<b class="fc">&nbsp;        this.multipleChoiceRepository = multipleChoiceRepository;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public DrawingQuestionRepository getHanziDrawingRepository() {
<b class="nc">&nbsp;        return hanziDrawingRepository;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setHanziDrawingRepository(DrawingQuestionRepository hanziDrawingRepository) {
<b class="fc">&nbsp;        this.hanziDrawingRepository = hanziDrawingRepository;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    @Autowired
<b class="fc">&nbsp;    public CSVService(@Qualifier(&quot;choiceQuestionRepository&quot;) ChoiceQuestionRepository choiceQuestionRepository, @Qualifier(&quot;drawingQuestionRepository&quot;) DrawingQuestionRepository drawingQuestionRepository) {</b>
<b class="fc">&nbsp;        this.multipleChoiceRepository = choiceQuestionRepository;</b>
<b class="fc">&nbsp;        this.hanziDrawingRepository = drawingQuestionRepository;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void saveChoiceQuestion(List&lt;MultipleChoice&gt; questions) {
&nbsp;        try {
<b class="fc">&nbsp;            multipleChoiceRepository.saveAll(questions);</b>
&nbsp;        }
<b class="fc">&nbsp;        catch (Exception e) {</b>
<b class="fc">&nbsp;            throw new RuntimeException(&quot;fail to store csv data: &quot; + e.getMessage());</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void saveDrawQuestion(List&lt;HanziDrawing&gt; questions) {
&nbsp;        try {
<b class="fc">&nbsp;            hanziDrawingRepository.saveAll(questions);</b>
&nbsp;        }
<b class="fc">&nbsp;        catch (Exception e) {</b>
<b class="fc">&nbsp;            throw new RuntimeException(&quot;fail to store csv data: &quot; + e.getMessage());</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;
&nbsp;    public List&lt;MultipleChoiceDTO&gt; getMultipleChoices() {
&nbsp;
<b class="fc">&nbsp;        List&lt;MultipleChoice&gt; lists = multipleChoiceRepository.findAll();</b>
<b class="fc">&nbsp;        List&lt;MultipleChoiceDTO&gt; questionsDTO = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;        for(MultipleChoice question: lists){</b>
<b class="fc">&nbsp;            questionsDTO.add(MultiChoiceDTOMapper.DTOMapper.INSTANCE.convertEntityToDTO(question));</b>
<b class="fc">&nbsp;        }</b>
&nbsp;
<b class="fc">&nbsp;        return questionsDTO;</b>
&nbsp;    }
&nbsp;
&nbsp;    public List&lt;HanziDrawingDTO&gt; getHanziDrawings(){
&nbsp;
<b class="fc">&nbsp;        List&lt;HanziDrawing&gt; data = hanziDrawingRepository.findAll();</b>
<b class="fc">&nbsp;        List&lt;HanziDrawingDTO&gt; questionsDTO = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;        for(HanziDrawing question: data){</b>
<b class="fc">&nbsp;            questionsDTO.add(HanziDrawDTOMapper.DTOMapper.INSTANCE.convertEntityToDTO(question));</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        return questionsDTO;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    // a recursive method to correspond different modes to certain actions
&nbsp;    public List&lt;QuestionDTO&gt; fetchQuestionSet(String level, String mode, int numQuestion) {
<b class="fc">&nbsp;        if(mode.equals(&quot;Mixed&quot;)){</b>
<b class="fc">&nbsp;            List&lt;QuestionDTO&gt; result = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;            result.addAll(fetchQuestionSet(level,&quot;HanziDrawing&quot;,numQuestion/2));</b>
<b class="fc">&nbsp;            result.addAll(fetchQuestionSet(level,&quot;MultipleChoice&quot;,numQuestion/2));</b>
<b class="fc">&nbsp;            Collections.shuffle(result);</b>
<b class="fc">&nbsp;            return result;</b>
&nbsp;        }
&nbsp;        else{
<b class="fc">&nbsp;            List&lt;Integer&gt; idSet = findAllIdMatches(level,mode);</b>
<b class="fc">&nbsp;            return randomSelect(mode,idSet,numQuestion);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // find all the questions of the given Level
&nbsp;    private List&lt;Integer&gt; findAllIdMatches(String level,String typeOfQuestion){
<b class="fc">&nbsp;        if(typeOfQuestion.equals(&quot;HanziDrawing&quot;)){</b>
<b class="fc">&nbsp;            return getIdFromQuestions(hanziDrawingRepository.findAllByLevel(level));</b>
&nbsp;        }
<b class="fc">&nbsp;        else if (typeOfQuestion.equals(&quot;MultipleChoice&quot;)) {</b>
<b class="fc">&nbsp;            List&lt;Question&gt; questionList = multipleChoiceRepository.findAllByLevel(level);</b>
<b class="fc">&nbsp;            return getIdFromQuestions(multipleChoiceRepository.findAllByLevel(level));</b>
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    // get all the IDs from the questions that meet the criteria
&nbsp;    private List&lt;Integer&gt; getIdFromQuestions(List&lt;Question&gt; questionList){
<b class="fc">&nbsp;        List&lt;Integer&gt; idList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        for(Question question:questionList){</b>
<b class="fc">&nbsp;            idList.add(question.getId());</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        return idList;</b>
&nbsp;    }
&nbsp;
&nbsp;    // the random selection process to return the required questionPack
&nbsp;    private List&lt;QuestionDTO&gt; randomSelect(String typeOfQuestion, List&lt;Integer&gt; idSet, int num){
<b class="fc">&nbsp;        List&lt;QuestionDTO&gt; result = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        List&lt;Integer&gt; selectedIdSet = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;        if(idSet.size() &gt; num){</b>
<b class="fc">&nbsp;            Collections.shuffle(idSet);</b>
<b class="fc">&nbsp;            selectedIdSet = idSet.subList(0,num);</b>
&nbsp;        }
&nbsp;        else{
<b class="fc">&nbsp;            selectedIdSet = idSet;</b>
&nbsp;        }
<b class="fc">&nbsp;        for(int i:selectedIdSet){</b>
<b class="fc">&nbsp;            if(typeOfQuestion.equals(&quot;HanziDrawing&quot;)){</b>
<b class="fc">&nbsp;                result.add(HanziDrawDTOMapper.DTOMapper.INSTANCE.convertEntityToDTO(hanziDrawingRepository.findById(i).orElse(null)));</b>
&nbsp;            }
<b class="fc">&nbsp;            else if (typeOfQuestion.equals(&quot;MultipleChoice&quot;)) {</b>
<b class="fc">&nbsp;                result.add(MultiChoiceDTOMapper.DTOMapper.INSTANCE.convertEntityToDTO(multipleChoiceRepository.findById(i).orElse(null)));</b>
&nbsp;            }
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        return result;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-04-27 20:49</div>
</div>
</body>
</html>
